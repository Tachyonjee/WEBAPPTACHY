<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Coaching App{% endblock %}</title>
    
    <!-- Bootstrap CSS with Replit Dark Theme -->
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#0d1117">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Coaching App">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéì</text></svg>">
    
    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- PWA Install Banner -->
    <div id="pwa-install-banner" class="alert alert-info alert-dismissible d-none" role="alert">
        <i class="fas fa-download me-2"></i>
        <strong>Install App:</strong> Add this app to your home screen for a better experience!
        <button type="button" class="btn btn-sm btn-outline-info ms-2" id="pwa-install-btn">Install</button>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    
    <!-- Kiosk Mode Banner -->
    {% if session.get('device_type') == 'kiosk' %}
    <div class="alert alert-warning mb-0" role="alert">
        <i class="fas fa-desktop me-2"></i>
        <strong>Kiosk Mode:</strong> You are using a shared device. Your session will end automatically.
    </div>
    {% endif %}
    
    <!-- Impersonation Banner -->
    {% if session.get('impersonated') %}
    <div class="alert alert-danger mb-0" role="alert">
        <i class="fas fa-user-shield me-2"></i>
        <strong>Admin View:</strong> You are viewing as another user (Read-only mode)
    </div>
    {% endif %}
    
    <!-- Navigation -->
    {% include 'shared/navbar.html' %}
    
    <!-- Flash Messages -->
    {% include 'shared/flash.html' %}
    
    <!-- Main Content -->
    <main class="{% block main_class %}container my-4{% endblock %}">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="bg-dark mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-info">Coaching App</h6>
                    <p class="small text-muted">Your learning journey, powered by AI</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="small text-muted">
                        <p class="mb-1">Made with ‚ù§Ô∏è for JEE/NEET aspirants</p>
                        <p class="mb-0">&copy; 2024 Coaching App. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/pwa.js') }}"></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    
    <!-- Global JavaScript Variables -->
    <script>
        window.APP_CONFIG = {
            isAuthenticated: {{ 'true' if session.get('user_id') else 'false' }},
            userId: {{ session.get('user_id', 'null') }},
            userRole: '{{ session.get('user_role', '') }}',
            csrfToken: '{{ csrf_token() if csrf_token else '' }}'
        };
    </script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>
